<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Embedded map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/map.css" rel="stylesheet">
    <link href="vendor/leaflet/leaflet.css" rel="stylesheet">
    <style>
        html,body {
            width: 100%;
            height: 100%;
        }
        section.map {
            display: flex;
            height: 100%;
            width: 100%;
        }
        #azniirkh-map {
            height: 100%;
            flex: 1 50%;
        }
        #azniirkh-legend {
            height: 100%;
            flex: 1;
        }
    </style>
</head>
<body>

<section class="map">
    <div id="azniirkh-map"></div>
    <div id="azniirkh-legend">
        <div class="card">
            <div class="card-header mb-1">–°–ª–æ–∏</div>
            <div class="card-body p-0">
                <div class="text-right mb-2">
                    <span class="badge badge-light" id="gis-zoom-azov">üîé –ê–∑–æ–≤</span>
                    <span class="badge badge-light" id="gis-zoom-blacksea">üîé –ß–ú</span>
                    <span class="badge badge-light" id="gis-zoom-rostov">üîé –†–æ—Å—Ç–æ–≤</span>
                    <span class="badge badge-light" id="gis-zoom-krasnodar">üîé –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</span>
                </div>
                <div class="gis-layer-list">
                    <div class="gis-group-layer ml-2 pl-3">
                        <div class="gis-element-title">–ë–∞–∑–æ–≤—ã–µ —Å–ª–æ–∏</div>
                        <small class="text-muted d-none d-sm-block">–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–ª–æ–∏ –∫–∞—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</small>
                        <div class="gis-element-items pl-2 d-none">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="map-tile" checked disabled>
                                <label class="custom-control-label" for="map-tile">–ë–∞–∑–æ–≤—ã–π —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã–π —Å–Ω–∏–º–æ–∫</label>
                            </div>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="gis-cities" data-toggle="point" data-target="azniirkh_zones:south_russia_placekeys">
                                <label class="custom-control-label" for="gis-cities">–ì–æ—Ä–æ–¥–∞</label>
                            </div>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="gis-admin-borders">
                                <label class="custom-control-label" for="gis-admin-borders">–ó–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ê–∑–ù–ò–ò–†–•</label>
                            </div>
                        </div>
                    </div>
                    <div class="gis-group-layer ml-2 pl-3">
                        <div class="gis-element-title">–†—ã–±–æ–ª–æ–≤–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</div>
                        <small class="text-muted d-none d-sm-block">–ì—Ä–∞–Ω–∏—Ü—ã —Ä—ã–±–æ–ª–æ–≤–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ —Å—É–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞</small>
                        <div class="gis-element-items pl-2 d-none">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="gis-fisharea-bs" data-toggle="multipoly" data-target="azniirkh_zones:blacksea-poly-zones">
                                <label class="custom-control-label" for="gis-fisharea-bs">–ß–µ—Ä–Ω–æ–µ –º–æ—Ä–µ</label>
                            </div>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="gis-fisharea-as" data-toggle="multiline" data-target="azniirkh_zones:test-zones">
                                <label class="custom-control-label" for="gis-fisharea-as">–ê–∑–æ–≤—Å–∫–æ–µ –º–æ—Ä–µ</label>
                            </div>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="gis-fisharea-iw">
                                <label class="custom-control-label" for="gis-fisharea-iw">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤–æ–¥–æ–µ–º—ã</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/leaflet/leaflet.js"></script>
    <script src="js/gis.js"></script>

    <script>
        var enabledLayers = {};

        // define map object with center
        var map = L.map('azniirkh-map').setView([46, 36], 7);
        // load basic tiles from WMS
        var bg = L.tileLayer.wms('https://map.azniirkh.ru/geoserver/azniirkh_zones/wms?', {
            layers: 'base_layer_250_01_geotiff',
            attribution: '&copy; <a href="http://azniirkh.ru">AzNIIRKH</a>'
        }).addTo(map);

        // execute after-load features with jquery
        $(function(){
            // visual display hidden elements
            $('.gis-group-layer').on('click', function(){
                var triggerDom = $(this).find('.gis-element-items');
                if (triggerDom.hasClass('d-none')) {
                    $('.gis-element-items').addClass('d-none');
                }
                triggerDom.toggleClass('d-none');
            });
            // process geojson data display or hide based on checkbox status
            $('input[type=checkbox]').on('change', function(){
                var checked = $(this).is(':checked');

                var layerName = $(this).attr('data-target');
                var layerType = $(this).attr('data-toggle');

                if (!layerName || layerName.length < 3 || !layerType || layerType.length < 3) {
                    return false;
                }

                if (checked) {
                    if (layerName in enabledLayers && enabledLayers[layerName] === true) {
                        return true; // do not load data if always used
                    }
                    displayLayerType(layerType, layerName, map);
                    enabledLayers[layerName] = true;
                } else {
                    removeLayer(layerName);
                    enabledLayers[layerName] = false;
                }
            });
            // process zoom buttons
            $('#gis-zoom-azov').on('click', function(){
                map.setView([46.1, 36.5], 8);
            });
            $('#gis-zoom-blacksea').on('click', function(){
                map.setView([43.8, 36.2], 8);
            });
            $('#gis-zoom-rostov').on('click', function(){
                map.setView([47.2, 39.7], 9);
            });
            $('#gis-zoom-krasnodar').on('click', function(){
                map.setView([45.0, 38.9], 9);
            });
        });

        //map.on('click', function (e) {
        //    alert("Lat: " + e.latlng.lat + ", lon: " + e.latlng.lng);
        //});
    </script>
</body>
</html>